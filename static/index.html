<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yeşil Dönüşüm Başvuru Analiz Sistemi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .header h1 {
            color: #2d3748;
            font-size: 32px;
            margin-bottom: 10px;
        }

        /* UPDATED: 2025-10-23 02:30 - BELGE GÖSTER BUTONU EKLENDİ */

        .header p {
            color: #718096;
            font-size: 16px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            color: #718096;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .stat-card .value {
            color: #2d3748;
            font-size: 36px;
            font-weight: bold;
        }

        .search-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .search-section h2 {
            color: #2d3748;
            margin-bottom: 20px;
        }

        .search-form {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .search-form input {
            flex: 1;
            min-width: 250px;
            padding: 12px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .search-form input:focus {
            outline: none;
            border-color: #667eea;
        }

        .search-form button {
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .search-form button:hover {
            transform: scale(1.05);
        }

        .results-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .basvuru-list {
            margin-top: 20px;
        }

        .basvuru-item {
            padding: 20px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .basvuru-item:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }

        .basvuru-item h3 {
            color: #2d3748;
            margin-bottom: 10px;
        }

        .basvuru-item p {
            color: #718096;
            margin-bottom: 5px;
        }

        .detail-view {
            display: none;
        }

        .detail-view.active {
            display: block;
        }

        .back-btn {
            padding: 10px 20px;
            background: #e2e8f0;
            color: #2d3748;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .basvuru-detail {
            background: #f7fafc;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .basvuru-detail h2 {
            color: #2d3748;
            margin-bottom: 15px;
        }

        .basvuru-detail .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }

        .basvuru-detail .info-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: white;
            border-radius: 8px;
        }

        .basvuru-detail .info-item strong {
            color: #4a5568;
        }

        .belgeler-section {
            margin-top: 30px;
        }

        .belge-card {
            background: #f7fafc;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid #667eea;
        }

        .belge-card h3 {
            color: #2d3748;
            margin-bottom: 15px;
        }

        .belge-card .belge-info {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .belge-card .badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge.success {
            background: #c6f6d5;
            color: #22543d;
        }

        .badge.warning {
            background: #feebc8;
            color: #7c2d12;
        }

        .analysis-data {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .analysis-data h4 {
            color: #2d3748;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }

        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .data-item {
            padding: 10px;
            background: #f7fafc;
            border-radius: 5px;
        }

        .data-item strong {
            color: #4a5568;
            font-size: 12px;
            display: block;
            margin-bottom: 5px;
        }

        .data-item span {
            color: #2d3748;
            font-size: 14px;
        }

        .btn-view-doc {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-view-doc:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
        }

        .modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 0;
            width: 90%;
            max-width: 1200px;
            height: 90vh;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 20px;
        }

        .close {
            color: white;
            font-size: 35px;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
        }

        .close:hover {
            opacity: 0.7;
        }

        .modal-body {
            padding: 20px;
            height: calc(90vh - 80px);
            overflow: auto;
        }

        .modal-body iframe,
        .modal-body img {
            width: 100%;
            min-height: 70vh;
            border: none;
            border-radius: 8px;
        }

        .json-toggle {
            background: #4299e1;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 10px;
        }

        .json-view {
            display: none;
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }

        .json-view.active {
            display: block;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #718096;
        }

        .error {
            background: #fed7d7;
            color: #742a2a;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🌱 Sanayide Yeşil Dönüşüm Başvuru Değerlendirme Sistemi</h1>
            <p>Başvuru analiz sonuçlarını görüntüleme ve raporlama sistemi</p>
        </div>

        <div class="stats" id="stats">
            <div class="stat-card">
                <h3>Toplam Başvuru</h3>
                <div class="value" id="stat-total">-</div>
            </div>
            <div class="stat-card">
                <h3>İşlenen Başvuru</h3>
                <div class="value" id="stat-processed">-</div>
            </div>
            <div class="stat-card">
                <h3>Başarılı Analiz</h3>
                <div class="value" id="stat-success">-</div>
            </div>
            <div class="stat-card">
                <h3>Kaydedilen Chunk</h3>
                <div class="value" id="stat-chunks">-</div>
            </div>
        </div>

        <div class="search-section">
            <h2>🔍 Başvuru Ara</h2>
            <div class="search-form">
                <input type="text" id="search-input" placeholder="Takip No, TC Kimlik veya Ad Soyad giriniz">
                <button onclick="searchBasvuru()">Ara</button>
            </div>
        </div>

        <div class="results-section">
            <div id="list-view">
                <h2>📋 Son İşlenen Başvurular</h2>
                <div class="basvuru-list" id="basvuru-list">
                    <div class="loading">Yükleniyor...</div>
                </div>
            </div>

            <div id="detail-view" class="detail-view">
                <button class="back-btn" onclick="showListView()">⬅ Geri</button>
                <div id="detail-content"></div>
            </div>
        </div>
    </div>

    <script>
        // API base URL
        const API_URL = window.location.origin;

        // Sayfa yüklendiğinde
        document.addEventListener('DOMContentLoaded', () => {
            loadStats();
            loadLatestBasvurular();
        });

        // İstatistikleri yükle
        async function loadStats() {
            try {
                const response = await fetch(`${API_URL}/api/stats`);
                const data = await response.json();

                document.getElementById('stat-total').textContent = data.islenen_basvuru.toLocaleString('tr-TR');
                document.getElementById('stat-processed').textContent = data.basarili_analiz.toLocaleString('tr-TR');
                document.getElementById('stat-success').textContent = data.basarili_belge.toLocaleString('tr-TR');
                document.getElementById('stat-chunks').textContent = data.toplam_chunk.toLocaleString('tr-TR');
            } catch (error) {
                console.error('İstatistikler yüklenemedi:', error);
                alert('İstatistikler yüklenemedi: ' + error.message);
            }
        }

        // Son başvuruları yükle
        async function loadLatestBasvurular() {
            try {
                const response = await fetch(`${API_URL}/api/basvurular/latest?limit=20`);
                const basvurular = await response.json();

                const listEl = document.getElementById('basvuru-list');
                listEl.innerHTML = '';

                if (basvurular.length === 0) {
                    listEl.innerHTML = '<div style="text-align: center; padding: 40px; color: #718096;">Henüz analiz edilmiş başvuru yok</div>';
                    return;
                }

                basvurular.forEach(b => {
                    const item = document.createElement('div');
                    item.className = 'basvuru-item';
                    item.onclick = () => loadBasvuruDetail(b.takipNo);

                    const tarih = b.basvuruTarihi ? new Date(b.basvuruTarihi).toLocaleDateString('tr-TR') : 'N/A';
                    const analiz_oran = b.toplam_belge > 0 ? Math.round((b.analiz_edilmis_belge / b.toplam_belge) * 100) : 0;

                    item.innerHTML = `
                        <h3>Takip No: ${b.takipNo}</h3>
                        <p><strong>Başvuran:</strong> ${b.basvuruYapanAd} ${b.basvuruYapanSoyad}</p>
                        <p><strong>Tarih:</strong> ${tarih}</p>
                        <p><strong>Belgeler:</strong> ${b.analiz_edilmis_belge}/${b.toplam_belge} analiz edildi (${analiz_oran}%)</p>
                        <p><strong>Başarılı:</strong> ${b.basarili_analiz} belge</p>
                    `;

                    listEl.appendChild(item);
                });
            } catch (error) {
                console.error('Başvurular yüklenemedi:', error);
                document.getElementById('basvuru-list').innerHTML = '<div class="error">Başvurular yüklenemedi: ' + error.message + '</div>';
            }
        }

        // Başvuru ara
        async function searchBasvuru() {
            const query = document.getElementById('search-input').value.trim();
            if (!query) return;

            try {
                // Önce takip no dene
                let response = await fetch(`${API_URL}/api/search?takip_no=${encodeURIComponent(query)}`);

                if (response.status === 404) {
                    // TC dene
                    response = await fetch(`${API_URL}/api/search?tc=${encodeURIComponent(query)}`);
                }

                if (response.status === 404) {
                    // Ad soyad dene
                    response = await fetch(`${API_URL}/api/search?ad_soyad=${encodeURIComponent(query)}`);
                }

                if (response.ok) {
                    const result = await response.json();
                    loadBasvuruDetail(result.takipNo);
                } else {
                    alert('Başvuru bulunamadı!');
                }
            } catch (error) {
                console.error('Arama hatası:', error);
                alert('Arama sırasında hata oluştu!');
            }
        }

        // Enter tuşu ile arama
        document.getElementById('search-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') searchBasvuru();
        });

        // Başvuru detayını yükle
        async function loadBasvuruDetail(takipNo) {
            try {
                const response = await fetch(`${API_URL}/api/basvuru/takip/${takipNo}`);
                const data = await response.json();

                showDetailView();
                renderBasvuruDetail(data);
            } catch (error) {
                console.error('Detay yüklenemedi:', error);
                alert('Başvuru detayı yüklenemedi!');
            }
        }

        // Başvuru detayını render et
        function renderBasvuruDetail(data) {
            console.log('renderBasvuruDetail çağrıldı, data:', data);
            const b = data.basvuru;
            const belgeler = data.belgeler;
            console.log('Belgeler sayısı:', belgeler?.length);

            let html = `
                <div class="basvuru-detail">
                    <h2>📋 Başvuru Bilgileri - ${b.takipNo}</h2>
                    <div class="info-grid">
                        <div class="info-item">
                            <strong>Takip No:</strong>
                            <span>${b.takipNo}</span>
                        </div>
                        <div class="info-item">
                            <strong>Başvuru ID:</strong>
                            <span>${b.basvuruId}</span>
                        </div>
                        <div class="info-item">
                            <strong>Başvuran:</strong>
                            <span>${b.basvuruYapanAd} ${b.basvuruYapanSoyad}</span>
                        </div>
                        <div class="info-item">
                            <strong>TC:</strong>
                            <span>${b.basvuruYapanVatandasTC}</span>
                        </div>
                        <div class="info-item">
                            <strong>Tarih:</strong>
                            <span>${new Date(b.basvuruTarihi).toLocaleString('tr-TR')}</span>
                        </div>
                        <div class="info-item">
                            <strong>Durum:</strong>
                            <span>${b.basvuruDurum}</span>
                        </div>
                        <div class="info-item">
                            <strong>Hizmet:</strong>
                            <span>${b.hizmetAdi} (${b.hizmetId})</span>
                        </div>
                        ${b.kararDurum ? `
                        <div class="info-item">
                            <strong>Karar:</strong>
                            <span>${b.kararDurum}</span>
                        </div>
                        ` : ''}
                    </div>
                </div>

                <div class="belgeler-section">
                    <h2>📄 Belgeler ve Analiz Sonuçları</h2>
            `;

            belgeler.forEach((belge, index) => {
                html += `
                    <div class="belge-card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h3 style="margin: 0;">${belge.belgeAdi}</h3>
                            <button class="btn-view-doc" onclick="viewDocument('${b.takipNo}', '${belge.belgeAdi}')">
                                📄 Belge Göster
                            </button>
                        </div>
                        <div class="belge-info">
                            <span class="badge ${belge.basarili ? 'success' : 'warning'}">
                                ${belge.basarili ? '✓ Başarılı' : belge.log_id ? '✗ Başarısız' : '⏳ Analiz Edilmedi'}
                            </span>
                            ${belge.islem_suresi_sn ? `<span class="badge success">Süre: ${belge.islem_suresi_sn.toFixed(2)}s</span>` : ''}
                            ${belge.chunk_sayisi ? `<span class="badge success">${belge.chunk_sayisi} Chunk</span>` : ''}
                        </div>
                `;

                // Analiz sonuçlarını göster (varsa)
                if (belge.log_id && belge.chunks && belge.chunks.length > 0) {
                    belge.chunks.forEach((chunk, chunkIdx) => {
                        html += renderAnalysisData(belge.belgeTipi || belge.belgeAdi, chunk.data, `belge-${index}-chunk-${chunkIdx}`);
                    });
                } else if (!belge.log_id) {
                    html += `<div style="padding: 15px; background: #fff3cd; border-radius: 8px; margin-top: 10px; color: #856404;">
                        <i>Bu belge henüz analiz edilmemiş.</i>
                    </div>`;
                }

                html += `</div>`;
            });

            html += `</div>`;

            // Eğer merge edilmiş analiz sonuçları varsa göster
            if (data.analiz && data.analiz.sonuc) {
                const sonuc = data.analiz.sonuc;
                html += `
                    <div class="belgeler-section" style="margin-top: 30px;">
                        <h2>📊 Birleştirilmiş Analiz Sonuçları (Tüm Belgelerden)</h2>
                        <div class="belge-card">
                            <h4>👤 Kişisel Bilgiler</h4>
                            <div class="data-grid">
                                <div class="data-item"><strong>Ad Soyad:</strong><span>${sonuc.ad_soyad || 'N/A'}</span></div>
                                <div class="data-item"><strong>TC Kimlik:</strong><span>${sonuc.tc_kimlik_no || 'N/A'}</span></div>
                                <div class="data-item"><strong>Doğum Tarihi:</strong><span>${sonuc.dogum_tarihi || 'N/A'}</span></div>
                                <div class="data-item"><strong>Doğum Yeri:</strong><span>${sonuc.dogum_yeri || 'N/A'}</span></div>
                            </div>

                            <h4 style="margin-top: 20px;">🎓 Eğitim</h4>
                            <div class="data-grid">
                                <div class="data-item"><strong>Üniversite:</strong><span>${sonuc.mezun_universite || 'N/A'}</span></div>
                                <div class="data-item"><strong>Bölüm:</strong><span>${sonuc.mezun_bolum || 'N/A'}</span></div>
                                <div class="data-item"><strong>Mezuniyet Yılı:</strong><span>${sonuc.mezuniyet_yili || 'N/A'}</span></div>
                                <div class="data-item"><strong>Seviye:</strong><span>${sonuc.egitim_seviyesi || 'N/A'}</span></div>
                            </div>

                            <h4 style="margin-top: 20px;">💼 İş Deneyimi (Toplam)</h4>
                            <div class="data-grid">
                                <div class="data-item"><strong>Toplam Deneyim:</strong><span>${sonuc.toplam_is_deneyimi_yil || 0} yıl ${sonuc.toplam_is_deneyimi_ay || 0} ay</span></div>
                                <div class="data-item"><strong>Enerji:</strong><span>${sonuc.tecrube_enerji || 0} yıl</span></div>
                                <div class="data-item"><strong>Metal:</strong><span>${sonuc.tecrube_metal || 0} yıl</span></div>
                                <div class="data-item"><strong>Kimya:</strong><span>${sonuc.tecrube_kimya || 0} yıl</span></div>
                                <div class="data-item"><strong>Mineral:</strong><span>${sonuc.tecrube_mineral || 0} yıl</span></div>
                                <div class="data-item"><strong>Atık:</strong><span>${sonuc.tecrube_atik || 0} yıl</span></div>
                            </div>

                            <h4 style="margin-top: 20px;">✅ Uygunluk Durumu</h4>
                            <div class="data-grid">
                                <div class="data-item"><strong>Adli Sicil:</strong><span>${sonuc.adli_sicil_varmi ? '❌ Var' : '✅ Yok'}</span></div>
                                <div class="data-item"><strong>Yeşil Dönüşüm Tecrübesi:</strong><span>${sonuc.yeşil_donusum_tecrubesi ? '✅ Var' : '❌ Yok'}</span></div>
                                <div class="data-item"><strong>Çevre Mevzuatı Bilgisi:</strong><span>${sonuc.cevre_mevzuati_bilgisi ? '✅ Var' : '❌ Yok'}</span></div>
                                <div class="data-item"><strong>Proje/Yayın Sayısı:</strong><span>${sonuc.proje_yayin_sayisi || 0}</span></div>
                            </div>
                        </div>
                    </div>
                `;
            }

            document.getElementById('detail-content').innerHTML = html;
        }

        // Analiz verisini render et
        function renderAnalysisData(belgeTipi, data, id) {
            let html = `<div class="analysis-data">`;

            // Belge tipine göre özel render
            if (belgeTipi.includes('CV') || belgeTipi.includes('Özgeçmiş')) {
                html += renderCVData(data);
            } else if (belgeTipi.includes('SGK')) {
                html += renderSGKData(data);
            } else if (belgeTipi.includes('Diploma')) {
                html += renderDiplomaData(data);
            } else if (belgeTipi.includes('Adli Sicil')) {
                html += renderAdliSicilData(data);
            } else {
                html += renderGenericData(data);
            }

            // Ham JSON göster butonu
            html += `
                <button class="json-toggle" onclick="toggleJSON('json-${id}')">Ham JSON Göster</button>
                <div class="json-view" id="json-${id}">${JSON.stringify(data, null, 2)}</div>
            `;

            html += `</div>`;
            return html;
        }

        // CV verisi render
        function renderCVData(data) {
            return `
                <h4>👤 Kişisel Bilgiler</h4>
                <div class="data-grid">
                    <div class="data-item"><strong>Ad Soyad:</strong><span>${data.ad_soyad || 'N/A'}</span></div>
                    <div class="data-item"><strong>Doğum Yılı:</strong><span>${data.dogum_yili || 'N/A'}</span></div>
                    <div class="data-item"><strong>Email:</strong><span>${data.iletisim_email || 'N/A'}</span></div>
                    <div class="data-item"><strong>Telefon:</strong><span>${data.iletisim_telefon || 'N/A'}</span></div>
                </div>

                <h4 style="margin-top: 20px;">🎓 Eğitim</h4>
                <div class="data-grid">
                    <div class="data-item"><strong>Seviye:</strong><span>${data.egitim_seviyesi || 'N/A'}</span></div>
                    <div class="data-item"><strong>Üniversite:</strong><span>${data.mezun_universite || 'N/A'}</span></div>
                    <div class="data-item"><strong>Bölüm:</strong><span>${data.mezun_bolum || 'N/A'}</span></div>
                    <div class="data-item"><strong>Mezuniyet:</strong><span>${data.mezuniyet_yili || 'N/A'}</span></div>
                </div>

                ${data.diplomalar && data.diplomalar.length > 0 ? `
                <h4 style="margin-top: 20px;">📜 Tüm Diplomalar (${data.diplomalar.length})</h4>
                ${data.diplomalar.map((diploma, index) => `
                <div class="data-grid" style="border: 1px solid #e0e0e0; padding: 10px; margin-bottom: 10px; border-radius: 5px;">
                    <div style="grid-column: 1/-1; font-weight: bold; color: #2c3e50; margin-bottom: 5px;">Diploma ${index + 1}</div>
                    <div class="data-item"><strong>Ad Soyad:</strong><span>${diploma.ad || ''} ${diploma.soyad || ''}</span></div>
                    <div class="data-item"><strong>TC:</strong><span>${diploma.tc_kimlik_no || 'N/A'}</span></div>
                    <div class="data-item"><strong>Üniversite:</strong><span>${diploma.universite || 'N/A'}</span></div>
                    <div class="data-item"><strong>Fakülte:</strong><span>${diploma.fakulte || 'N/A'}</span></div>
                    <div class="data-item"><strong>Program/Bölüm:</strong><span>${diploma.program_bolum || 'N/A'}</span></div>
                    <div class="data-item"><strong>Mezuniyet Tarihi:</strong><span>${diploma.mezuniyet_tarihi || 'N/A'}</span></div>
                    <div class="data-item"><strong>Diploma No:</strong><span>${diploma.diploma_numarasi || 'N/A'}</span></div>
                    <div class="data-item"><strong>Not:</strong><span>${diploma.diploma_notu || 'N/A'}</span></div>
                    <div class="data-item"><strong>Durum:</strong><span>${diploma.durum || 'N/A'}</span></div>
                </div>
                `).join('')}
                ` : ''}

                <h4 style="margin-top: 20px;">💼 Deneyim</h4>
                <div class="data-grid">
                    <div class="data-item"><strong>Toplam:</strong><span>${data.toplam_is_deneyimi_yil || 0} yıl ${data.toplam_is_deneyimi_ay || 0} ay</span></div>
                    <div class="data-item"><strong>Enerji:</strong><span>${data.tecrube_enerji || 0} yıl</span></div>
                    <div class="data-item"><strong>Metal:</strong><span>${data.tecrube_metal || 0} yıl</span></div>
                    <div class="data-item"><strong>Kimya:</strong><span>${data.tecrube_kimya || 0} yıl</span></div>
                    <div class="data-item"><strong>Mineral:</strong><span>${data.tecrube_mineral || 0} yıl</span></div>
                    <div class="data-item"><strong>Atık:</strong><span>${data.tecrube_atik || 0} yıl</span></div>
                </div>

                <h4 style="margin-top: 20px;">🌱 Yeşil Dönüşüm</h4>
                <div class="data-grid">
                    <div class="data-item"><strong>Tecrübe:</strong><span>${data.yeşil_donusum_tecrubesi ? '✓ Var' : '✗ Yok'}</span></div>
                    <div class="data-item"><strong>Çevre Mevzuatı:</strong><span>${data.cevre_mevzuati_bilgisi ? '✓ Var' : '✗ Yok'}</span></div>
                    <div class="data-item"><strong>Enerji Verimliliği:</strong><span>${data.enerji_verimliligi_tecrubesi ? '✓ Var' : '✗ Yok'}</span></div>
                </div>
            `;
        }

        // SGK verisi render
        function renderSGKData(data) {
            return `
                <h4>💼 SGK İş Deneyimi</h4>
                <div class="data-grid">
                    <div class="data-item"><strong>Toplam Deneyim:</strong><span>${data.toplam_is_deneyimi_yil || 0} yıl ${data.toplam_is_deneyimi_ay || 0} ay</span></div>
                    <div class="data-item"><strong>Toplam Prim Günü:</strong><span>${(data.toplam_prim_gun || 0).toLocaleString('tr-TR')}</span></div>
                    <div class="data-item"><strong>İlk İşe Giriş:</strong><span>${data.ilk_ise_giris_tarihi || 'N/A'}</span></div>
                    <div class="data-item"><strong>Son Çıkış:</strong><span>${data.son_cikis_tarihi || 'N/A'}</span></div>
                </div>

                <h4 style="margin-top: 20px;">🏭 Sektör Deneyimleri</h4>
                <div class="data-grid">
                    <div class="data-item"><strong>Enerji:</strong><span>${data.tecrube_enerji_yil || 0}y ${data.tecrube_enerji_ay || 0}a</span></div>
                    <div class="data-item"><strong>Metal:</strong><span>${data.tecrube_metal_yil || 0}y ${data.tecrube_metal_ay || 0}a</span></div>
                    <div class="data-item"><strong>Mineral:</strong><span>${data.tecrube_mineral_yil || 0}y ${data.tecrube_mineral_ay || 0}a</span></div>
                    <div class="data-item"><strong>Kimya:</strong><span>${data.tecrube_kimya_yil || 0}y ${data.tecrube_kimya_ay || 0}a</span></div>
                    <div class="data-item"><strong>Atık:</strong><span>${data.tecrube_atik_yil || 0}y ${data.tecrube_atik_ay || 0}a</span></div>
                </div>
            `;
        }

        // Diploma verisi render
        function renderDiplomaData(data) {
            return `
                <h4>🎓 Diploma Bilgileri</h4>
                <div class="data-grid">
                    <div class="data-item"><strong>Öğrenci:</strong><span>${data.ogrenci_ad_soyad || 'N/A'}</span></div>
                    <div class="data-item"><strong>TC:</strong><span>${data.tc_kimlik_no || 'N/A'}</span></div>
                    <div class="data-item"><strong>Üniversite:</strong><span>${data.universite || 'N/A'} (${data.universite_tur || 'N/A'})</span></div>
                    <div class="data-item"><strong>Fakülte:</strong><span>${data.fakulte || 'N/A'}</span></div>
                    <div class="data-item"><strong>Bölüm:</strong><span>${data.bolum || 'N/A'}</span></div>
                    <div class="data-item"><strong>Eğitim Seviyesi:</strong><span>${data.egitim_seviyesi || 'N/A'}</span></div>
                    <div class="data-item"><strong>Mezuniyet Yılı:</strong><span>${data.mezuniyet_yili || 'N/A'}</span></div>
                    <div class="data-item"><strong>Diploma No:</strong><span>${data.diploma_no || 'N/A'}</span></div>
                    <div class="data-item"><strong>GANO:</strong><span>${data.genel_not_ortalamasi || 'N/A'} (${data.not_sistemi || 'N/A'})</span></div>
                </div>
            `;
        }

        // Adli sicil verisi render
        function renderAdliSicilData(data) {
            const hasRecord = data.adli_sicil_varmi;
            return `
                <h4>⚖️ Adli Sicil Kaydı</h4>
                <div style="padding: 20px; background: ${hasRecord ? '#fed7d7' : '#c6f6d5'}; border-radius: 8px; margin-bottom: 15px;">
                    <strong style="font-size: 18px; color: ${hasRecord ? '#742a2a' : '#22543d'};">
                        ${hasRecord ? '✗ Adli Sicil Kaydı VAR' : '✓ Adli Sicil Kaydı YOK'}
                    </strong>
                </div>
                <div class="data-grid">
                    <div class="data-item"><strong>Ad Soyad:</strong><span>${data.ad_soyad || 'N/A'}</span></div>
                    <div class="data-item"><strong>TC:</strong><span>${data.tc_kimlik_no || 'N/A'}</span></div>
                    <div class="data-item"><strong>Doğum Tarihi:</strong><span>${data.dogum_tarihi || 'N/A'}</span></div>
                    <div class="data-item"><strong>Doğum Yeri:</strong><span>${data.dogum_yeri || 'N/A'}</span></div>
                    <div class="data-item"><strong>Belge No:</strong><span>${data.belge_no || 'N/A'}</span></div>
                    <div class="data-item"><strong>Belge Tarihi:</strong><span>${data.belge_tarihi || 'N/A'}</span></div>
                </div>
            `;
        }

        // Genel veri render
        function renderGenericData(data) {
            let html = '<div class="data-grid">';
            for (const [key, value] of Object.entries(data)) {
                if (typeof value === 'object') continue;
                html += `<div class="data-item"><strong>${key}:</strong><span>${value || 'N/A'}</span></div>`;
            }
            html += '</div>';
            return html;
        }

        // JSON toggle
        function toggleJSON(id) {
            const el = document.getElementById(id);
            el.classList.toggle('active');
        }

        // View'ları değiştir
        function showDetailView() {
            document.getElementById('list-view').style.display = 'none';
            document.getElementById('detail-view').classList.add('active');
        }

        function showListView() {
            document.getElementById('list-view').style.display = 'block';
            document.getElementById('detail-view').classList.remove('active');
        }

        // Belge görüntüleme
        function viewDocument(takipNo, belgeAdi) {
            const modal = document.getElementById('documentModal');
            const modalTitle = document.getElementById('modalDocumentTitle');
            const modalBody = document.getElementById('modalDocumentBody');

            modalTitle.textContent = belgeAdi;
            modalBody.innerHTML = '<div style="text-align:center; padding: 40px;"><div style="display: inline-block; width: 50px; height: 50px; border: 5px solid #f3f3f3; border-top: 5px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite;"></div><p style="margin-top: 20px;">Belge yükleniyor...</p></div>';

            modal.style.display = 'block';

            const url = `${API_URL}/api/document/${takipNo}/${belgeAdi}`;
            const isPDF = belgeAdi.toLowerCase().endsWith('.pdf');
            const isImage = belgeAdi.match(/\.(jpg|jpeg|png|gif)$/i);

            if (isPDF) {
                modalBody.innerHTML = `<iframe src="${url}" style="width: 100%; height: calc(90vh - 100px); border: none; border-radius: 8px;"></iframe>`;
            } else if (isImage) {
                modalBody.innerHTML = `<img src="${url}" style="max-width: 100%; border-radius: 8px;">`;
            } else {
                modalBody.innerHTML = `<div style="text-align:center; padding: 40px;">
                    <p>Bu dosya türü tarayıcıda görüntülenemiyor.</p>
                    <a href="${url}" download class="btn-view-doc" style="display: inline-block; margin-top: 20px; text-decoration: none;">İndir</a>
                </div>`;
            }
        }

        function closeModal() {
            document.getElementById('documentModal').style.display = 'none';
        }

        // Modal dışına tıklanınca kapat
        window.onclick = function(event) {
            const modal = document.getElementById('documentModal');
            if (event.target == modal) {
                closeModal();
            }
        }
    </script>

    <!-- Modal: Belge Görüntüleyici -->
    <div id="documentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalDocumentTitle">Belge</h2>
                <button class="close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalDocumentBody">
                Yükleniyor...
            </div>
        </div>
    </div>

    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</body>
</html>
